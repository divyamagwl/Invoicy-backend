- name: Deployment on K8 cluster
  hosts: host_machine
  tasks:

    - name: Check Minikube status
      command: minikube status
      register: minikube_status
      changed_when: false
      failed_when: false

    - name: Printing Minikube status
      debug:
        var: minikube_status

    - name: Start Minikube
      become: false
      command: minikube start --cpus 4 --memory 8192
      when: "'Running' not in minikube_status.stdout"

    - name: Installing Addons
      become: false
      command: minikube addons enable ingress
      ignore_errors: true